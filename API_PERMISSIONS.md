# ğŸ” Quest API æƒé™æ§åˆ¶è¯´æ˜

## ğŸ“‹ æƒé™æ§åˆ¶åŸåˆ™

Quest API é‡‡ç”¨åŸºäºç”¨æˆ·IDçš„æƒé™æ§åˆ¶æœºåˆ¶ï¼Œç¡®ä¿ç”¨æˆ·åªèƒ½è®¿é—®å’Œæ“ä½œè‡ªå·±çš„æ•°æ®ã€‚

## ğŸ¯ æ ¸å¿ƒæƒé™è§„åˆ™

### 1. **ç”¨æˆ·è®¤è¯è¦æ±‚**
- é™¤äº†å¥åº·æ£€æŸ¥å’ŒAPIä¿¡æ¯ç«¯ç‚¹ï¼Œæ‰€æœ‰APIéƒ½éœ€è¦æœ‰æ•ˆçš„JWT token
- Tokené€šè¿‡ `Authorization: Bearer {token}` å¤´éƒ¨ä¼ é€’

### 2. **æ•°æ®éš”ç¦»åŸåˆ™**
- ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„æ•°æ®ï¼ˆinsightsã€tagsã€profileç­‰ï¼‰
- å³ä½¿æŒ‡å®šäº†å…¶ä»–ç”¨æˆ·çš„IDï¼Œç³»ç»Ÿä¹Ÿä¼šè‡ªåŠ¨é™åˆ¶ä¸ºå½“å‰ç™»å½•ç”¨æˆ·

### 3. **æƒé™æ£€æŸ¥æœºåˆ¶**
- **åˆ—è¡¨æŸ¥è¯¢**: è‡ªåŠ¨é™åˆ¶ä¸ºå½“å‰ç”¨æˆ·çš„æ•°æ®
- **å•ä¸ªèµ„æº**: éªŒè¯èµ„æºæ‰€æœ‰è€…æ˜¯å¦ä¸ºå½“å‰ç”¨æˆ·
- **åˆ›å»º/æ›´æ–°/åˆ é™¤**: è‡ªåŠ¨å…³è”åˆ°å½“å‰ç”¨æˆ·

## ğŸ” å…·ä½“APIæƒé™è¯´æ˜

### **Insights API**

#### è·å–insightsåˆ—è¡¨
```http
GET /api/v1/insights?user_id=xxx
```
**æƒé™é€»è¾‘ï¼š**
- å¦‚æœæŒ‡å®š `user_id`ï¼Œåªèƒ½æŸ¥çœ‹è‡ªå·±çš„insights
- å¦‚æœä¸æŒ‡å®š `user_id`ï¼Œé»˜è®¤æŸ¥çœ‹å½“å‰ç™»å½•ç”¨æˆ·çš„insights
- ç³»ç»Ÿä¼šè‡ªåŠ¨éªŒè¯ `user_id` æ˜¯å¦ä¸ºå½“å‰ç”¨æˆ·

#### è·å–å•ä¸ªinsight
```http
GET /api/v1/insights/{insight_id}
```
**æƒé™é€»è¾‘ï¼š**
- ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„insights
- å¦‚æœå°è¯•è®¿é—®å…¶ä»–ç”¨æˆ·çš„insightï¼Œè¿”å›403é”™è¯¯
- ç³»ç»Ÿä¼šæ£€æŸ¥ `insight.user_id == current_user.id`

#### åˆ›å»ºinsight
```http
POST /api/v1/insights
```
**æƒé™é€»è¾‘ï¼š**
- è‡ªåŠ¨å°† `user_id` è®¾ç½®ä¸ºå½“å‰ç™»å½•ç”¨æˆ·
- æ— éœ€åœ¨è¯·æ±‚ä½“ä¸­æŒ‡å®š `user_id`

#### æ›´æ–°insight
```http
PUT /api/v1/insights/{insight_id}
```
**æƒé™é€»è¾‘ï¼š**
- åªèƒ½æ›´æ–°è‡ªå·±çš„insights
- ç³»ç»Ÿä¼šéªŒè¯insightçš„æ‰€æœ‰æƒ

#### åˆ é™¤insight
```http
DELETE /api/v1/insights/{insight_id}
```
**æƒé™é€»è¾‘ï¼š**
- åªèƒ½åˆ é™¤è‡ªå·±çš„insights
- ç³»ç»Ÿä¼šéªŒè¯insightçš„æ‰€æœ‰æƒ

### **User Tags API**

#### è·å–æ ‡ç­¾åˆ—è¡¨
```http
GET /api/v1/user-tags?user_id=xxx
```
**æƒé™é€»è¾‘ï¼š**
- å¦‚æœæŒ‡å®š `user_id`ï¼Œåªèƒ½æŸ¥çœ‹è‡ªå·±çš„æ ‡ç­¾
- å¦‚æœä¸æŒ‡å®š `user_id`ï¼Œé»˜è®¤æŸ¥çœ‹å½“å‰ç™»å½•ç”¨æˆ·çš„æ ‡ç­¾
- ç³»ç»Ÿä¼šè‡ªåŠ¨éªŒè¯ `user_id` æ˜¯å¦ä¸ºå½“å‰ç”¨æˆ·

#### åˆ›å»ºæ ‡ç­¾
```http
POST /api/v1/user-tags
```
**æƒé™é€»è¾‘ï¼š**
- è‡ªåŠ¨å°† `user_id` è®¾ç½®ä¸ºå½“å‰ç™»å½•ç”¨æˆ·
- æ— éœ€åœ¨è¯·æ±‚ä½“ä¸­æŒ‡å®š `user_id`

#### æ›´æ–°/åˆ é™¤æ ‡ç­¾
```http
PUT /api/v1/user-tags/{tag_id}
DELETE /api/v1/user-tags/{tag_id}
```
**æƒé™é€»è¾‘ï¼š**
- åªèƒ½æ“ä½œè‡ªå·±çš„æ ‡ç­¾
- ç³»ç»Ÿä¼šéªŒè¯æ ‡ç­¾çš„æ‰€æœ‰æƒ

### **User Profile API**

#### è·å–/æ›´æ–°ç”¨æˆ·èµ„æ–™
```http
GET /api/v1/user/profile
PUT /api/v1/user/profile
```
**æƒé™é€»è¾‘ï¼š**
- åªèƒ½è®¿é—®å’Œä¿®æ”¹è‡ªå·±çš„èµ„æ–™
- ç³»ç»Ÿè‡ªåŠ¨ä½¿ç”¨å½“å‰ç™»å½•ç”¨æˆ·çš„ID

## ğŸš« æƒé™é”™è¯¯å“åº”

### 403 Forbidden
```json
{
  "success": false,
  "message": "æ— æƒé™è®¿é—®æ­¤insight",
  "statusCode": 403
}
```

### 401 Unauthorized
```json
{
  "success": false,
  "message": "æ— æ•ˆçš„è®¤è¯token",
  "statusCode": 401
}
```

## ğŸ”§ æƒé™æ£€æŸ¥å®ç°

### 1. **è‡ªåŠ¨ç”¨æˆ·IDè®¾ç½®**
```python
# åœ¨åˆ›å»ºèµ„æºæ—¶è‡ªåŠ¨è®¾ç½®ç”¨æˆ·ID
result = await service.create_resource(data, current_user["id"])
```

### 2. **æ‰€æœ‰æƒéªŒè¯**
```python
# åœ¨è®¿é—®å•ä¸ªèµ„æºæ—¶éªŒè¯æ‰€æœ‰æƒ
if resource.user_id != current_user["id"]:
    raise HTTPException(status_code=403, detail="æ— æƒé™è®¿é—®")
```

### 3. **åˆ—è¡¨æŸ¥è¯¢è¿‡æ»¤**
```python
# åœ¨æŸ¥è¯¢åˆ—è¡¨æ—¶è‡ªåŠ¨è¿‡æ»¤ç”¨æˆ·æ•°æ®
user_id = user_id or current_user["id"]
result = await service.get_resources(user_id=user_id)
```

## ğŸ“± å‰ç«¯é›†æˆå»ºè®®

### 1. **Tokenç®¡ç†**
```javascript
// åœ¨localStorageä¸­ä¿å­˜token
localStorage.setItem('access_token', token);

// åœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ token
headers: {
  'Authorization': `Bearer ${localStorage.getItem('access_token')}`
}
```

### 2. **é”™è¯¯å¤„ç†**
```javascript
// å¤„ç†æƒé™é”™è¯¯
if (response.status === 403) {
  console.log('æ— æƒé™è®¿é—®æ­¤èµ„æº');
  // é‡å®šå‘åˆ°ç™»å½•é¡µé¢æˆ–æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
}
```

### 3. **ç”¨æˆ·æ•°æ®éš”ç¦»**
```javascript
// å‰ç«¯ä¸éœ€è¦æŒ‡å®šuser_idï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä½¿ç”¨å½“å‰ç”¨æˆ·
const response = await fetch('/api/v1/insights', {
  headers: { 'Authorization': `Bearer ${token}` }
});
```

## ğŸ¯ æ€»ç»“

Quest API çš„æƒé™æ§åˆ¶ç³»ç»Ÿç¡®ä¿ï¼š

âœ… **æ•°æ®å®‰å…¨** - ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„æ•°æ®  
âœ… **è‡ªåŠ¨éš”ç¦»** - æ— éœ€æ‰‹åŠ¨æŒ‡å®šç”¨æˆ·ID  
âœ… **ç»Ÿä¸€éªŒè¯** - æ‰€æœ‰æ“ä½œéƒ½ç»è¿‡æƒé™æ£€æŸ¥  
âœ… **æ¸…æ™°é”™è¯¯** - æƒé™é”™è¯¯æœ‰æ˜ç¡®çš„é”™è¯¯ä¿¡æ¯  

è¿™ç§è®¾è®¡æ—¢ä¿è¯äº†å®‰å…¨æ€§ï¼Œåˆç®€åŒ–äº†å‰ç«¯é›†æˆï¼ğŸ”’
