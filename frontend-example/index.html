<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest API å‰ç«¯ç¤ºä¾‹</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .api-section {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            background: #fafafa;
        }
        .form-group {
            margin: 15px 0;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        input, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        button {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .result {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            white-space: pre-wrap;
            font-family: monospace;
            max-height: 300px;
            overflow-y: auto;
        }
        .error {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
        .success {
            background: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        .nav-tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 20px;
        }
        .nav-tab {
            padding: 10px 20px;
            cursor: pointer;
            border: 1px solid transparent;
            border-bottom: none;
            background: #f8f9fa;
        }
        .nav-tab.active {
            background: white;
            border-color: #ddd;
            border-bottom: 1px solid white;
            margin-bottom: -1px;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ Quest API å‰ç«¯é›†æˆç¤ºä¾‹</h1>
        <p>è¿™æ˜¯ä¸€ä¸ªå±•ç¤ºå¦‚ä½•è°ƒç”¨Quest APIçš„å‰ç«¯ç¤ºä¾‹é¡µé¢</p>
        
        <div class="nav-tabs">
            <div class="nav-tab active" onclick="showTab('auth')">è®¤è¯</div>
            <div class="nav-tab" onclick="showTab('user')">ç”¨æˆ·</div>
            <div class="nav-tab" onclick="showTab('insights')">è§è§£</div>
            <div class="nav-tab" onclick="showTab('tags')">æ ‡ç­¾</div>
        </div>

        <!-- è®¤è¯æ ‡ç­¾é¡µ -->
        <div id="auth" class="tab-content active">
            <div class="api-section">
                <h3>ğŸ” ç”¨æˆ·æ³¨å†Œ</h3>
                <div class="form-group">
                    <label>é‚®ç®±:</label>
                    <input type="email" id="signup-email" placeholder="test@example.com">
                </div>
                <div class="form-group">
                    <label>å¯†ç :</label>
                    <input type="password" id="signup-password" placeholder="å¯†ç ">
                </div>
                <div class="form-group">
                    <label>ç”¨æˆ·å:</label>
                    <input type="text" id="signup-username" placeholder="ç”¨æˆ·å">
                </div>
                <button onclick="signup()">æ³¨å†Œ</button>
                <div id="signup-result" class="result"></div>
            </div>

            <div class="api-section">
                <h3>ğŸ”‘ ç”¨æˆ·ç™»å½•</h3>
                <div class="form-group">
                    <label>é‚®ç®±:</label>
                    <input type="email" id="login-email" placeholder="test@example.com">
                </div>
                <div class="form-group">
                    <label>å¯†ç :</label>
                    <input type="password" id="login-password" placeholder="å¯†ç ">
                </div>
                <button onclick="login()">ç™»å½•</button>
                <div id="login-result" class="result"></div>
            </div>
        </div>

        <!-- ç”¨æˆ·æ ‡ç­¾é¡µ -->
        <div id="user" class="tab-content">
            <div class="api-section">
                <h3>ğŸ‘¤ è·å–ç”¨æˆ·èµ„æ–™</h3>
                <button onclick="getProfile()">è·å–èµ„æ–™</button>
                <div id="profile-result" class="result"></div>
            </div>

            <div class="api-section">
                <h3>âœï¸ æ›´æ–°ç”¨æˆ·èµ„æ–™</h3>
                <div class="form-group">
                    <label>ç”¨æˆ·å:</label>
                    <input type="text" id="update-username" placeholder="æ–°ç”¨æˆ·å">
                </div>
                <div class="form-group">
                    <label>å¤´åƒURL:</label>
                    <input type="url" id="update-avatar" placeholder="å¤´åƒå›¾ç‰‡URL">
                </div>
                <button onclick="updateProfile()">æ›´æ–°èµ„æ–™</button>
                <div id="update-result" class="result"></div>
            </div>
        </div>

        <!-- è§è§£æ ‡ç­¾é¡µ -->
        <div id="insights" class="tab-content">
            <div class="api-section">
                <h3>ğŸ“ åˆ›å»ºè§è§£</h3>
                <div class="form-group">
                    <label>æ ‡é¢˜:</label>
                    <input type="text" id="insight-title" placeholder="è§è§£æ ‡é¢˜">
                </div>
                <div class="form-group">
                    <label>æè¿°:</label>
                    <textarea id="insight-description" placeholder="è§è§£æè¿°" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label>å›¾ç‰‡URL:</label>
                    <input type="url" id="insight-image" placeholder="å›¾ç‰‡URL">
                </div>
                <button onclick="createInsight()">åˆ›å»ºè§è§£</button>
                <div id="create-insight-result" class="result"></div>
            </div>

            <div class="api-section">
                <h3>ğŸ“‹ è·å–è§è§£åˆ—è¡¨</h3>
                <button onclick="getInsights()">è·å–è§è§£</button>
                <div id="insights-result" class="result"></div>
            </div>
        </div>

        <!-- æ ‡ç­¾æ ‡ç­¾é¡µ -->
        <div id="tags" class="tab-content">
            <div class="api-section">
                <h3>ğŸ·ï¸ åˆ›å»ºæ ‡ç­¾</h3>
                <div class="form-group">
                    <label>æ ‡ç­¾åç§°:</label>
                    <input type="text" id="tag-name" placeholder="æ ‡ç­¾åç§°">
                </div>
                <div class="form-group">
                    <label>æ ‡ç­¾é¢œè‰²:</label>
                    <input type="color" id="tag-color" value="#007bff">
                </div>
                <button onclick="createTag()">åˆ›å»ºæ ‡ç­¾</button>
                <div id="create-tag-result" class="result"></div>
            </div>

            <div class="api-section">
                <h3>ğŸ“‹ è·å–ç”¨æˆ·æ ‡ç­¾</h3>
                <button onclick="getTags()">è·å–æ ‡ç­¾</button>
                <div id="tags-result" class="result"></div>
            </div>
        </div>
    </div>

    <script>
        // APIé…ç½®
        const API_BASE = 'http://localhost:3001/api/v1';
        let authToken = localStorage.getItem('authToken');

        // æ ‡ç­¾é¡µåˆ‡æ¢
        function showTab(tabName) {
            // éšè—æ‰€æœ‰æ ‡ç­¾é¡µ
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾é¡µ
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // æ˜¾ç¤ºç»“æœ
        function showResult(elementId, data, isError = false) {
            const element = document.getElementById(elementId);
            element.textContent = JSON.stringify(data, null, 2);
            element.className = `result ${isError ? 'error' : 'success'}`;
        }

        // ç”¨æˆ·æ³¨å†Œ
        async function signup() {
            try {
                const response = await fetch(`${API_BASE}/auth/signup`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        email: document.getElementById('signup-email').value,
                        password: document.getElementById('signup-password').value,
                        username: document.getElementById('signup-username').value
                    })
                });

                const data = await response.json();
                if (response.ok) {
                    showResult('signup-result', data);
                } else {
                    showResult('signup-result', data, true);
                }
            } catch (error) {
                showResult('signup-result', { error: error.message }, true);
            }
        }

        // ç”¨æˆ·ç™»å½•
        async function login() {
            try {
                const response = await fetch(`${API_BASE}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        email: document.getElementById('login-email').value,
                        password: document.getElementById('login-password').value
                    })
                });

                const data = await response.json();
                if (response.ok) {
                    authToken = data.token;
                    localStorage.setItem('authToken', authToken);
                    showResult('login-result', data);
                } else {
                    showResult('login-result', data, true);
                }
            } catch (error) {
                showResult('login-result', { error: error.message }, true);
            }
        }

        // è·å–ç”¨æˆ·èµ„æ–™
        async function getProfile() {
            if (!authToken) {
                showResult('profile-result', { error: 'è¯·å…ˆç™»å½•' }, true);
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/user/profile`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                const data = await response.json();
                if (response.ok) {
                    showResult('profile-result', data);
                } else {
                    showResult('profile-result', data, true);
                }
            } catch (error) {
                showResult('profile-result', { error: error.message }, true);
            }
        }

        // æ›´æ–°ç”¨æˆ·èµ„æ–™
        async function updateProfile() {
            if (!authToken) {
                showResult('update-result', { error: 'è¯·å…ˆç™»å½•' }, true);
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/user/profile`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        username: document.getElementById('update-username').value,
                        avatar_url: document.getElementById('update-avatar').value
                    })
                });

                const data = await response.json();
                if (response.ok) {
                    showResult('update-result', data);
                } else {
                    showResult('update-result', data, true);
                }
            } catch (error) {
                showResult('update-result', { error: error.message }, true);
            }
        }

        // åˆ›å»ºè§è§£
        async function createInsight() {
            if (!authToken) {
                showResult('create-insight-result', { error: 'è¯·å…ˆç™»å½•' }, true);
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/insights`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        title: document.getElementById('insight-title').value,
                        description: document.getElementById('insight-description').value,
                        image_url: document.getElementById('insight-image').value
                    })
                });

                const data = await response.json();
                if (response.ok) {
                    showResult('create-insight-result', data);
                } else {
                    showResult('create-insight-result', data, true);
                }
            } catch (error) {
                showResult('create-insight-result', { error: error.message }, true);
            }
        }

        // è·å–è§è§£åˆ—è¡¨
        async function getInsights() {
            try {
                const response = await fetch(`${API_BASE}/insights`);
                const data = await response.json();
                if (response.ok) {
                    showResult('insights-result', data);
                } else {
                    showResult('insights-result', data, true);
                }
            } catch (error) {
                showResult('insights-result', { error: error.message }, true);
            }
        }

        // åˆ›å»ºæ ‡ç­¾
        async function createTag() {
            if (!authToken) {
                showResult('create-tag-result', { error: 'è¯·å…ˆç™»å½•' }, true);
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/user-tags`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        name: document.getElementById('tag-name').value,
                        color: document.getElementById('tag-color').value
                    })
                });

                const data = await response.json();
                if (response.ok) {
                    showResult('create-tag-result', data);
                } else {
                    showResult('create-tag-result', data, true);
                }
            } catch (error) {
                showResult('create-tag-result', { error: error.message }, true);
            }
        }

        // è·å–ç”¨æˆ·æ ‡ç­¾
        async function getTags() {
            if (!authToken) {
                showResult('tags-result', { error: 'è¯·å…ˆç™»å½•' }, true);
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/user-tags`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                const data = await response.json();
                if (response.ok) {
                    showResult('tags-result', data);
                } else {
                    showResult('tags-result', data, true);
                }
            } catch (error) {
                showResult('tags-result', { error: error.message }, true);
            }
        }

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥ç™»å½•çŠ¶æ€
        window.onload = function() {
            if (authToken) {
                console.log('å·²ç™»å½•ï¼ŒToken:', authToken);
            } else {
                console.log('æœªç™»å½•');
            }
        };
    </script>
</body>
</html>

